import streamlit as st
from PIL import Image
from keras.preprocessing.image import load_img,img_to_array
import numpy as np
from keras.models import load_model

model = load_model('C:/Users/Divyansh/Desktop/Bird_Species_Classification_Streamlit/5_6087136421385077561.h5',compile=False)

lab = {0:"Abisara bifasciata Moore, 1877 – Double-banded Judy",1:"Abisara fylla",2:"Acraea terpsicore – Tawny Coster",3:"Acytolepis puspa felderi – Malabar Common Hedge Blue",4:"Aeromachus pygmaeus (Fabricius, 1775) – Pygmy Scrub Hopper",5:"Aeromachus stigmata (Moore, 1878) – Veined Scrub Hopper",6:"Aglais caschmirensis (Kollar, [1844]) – Indian Tortoiseshell",7:"Ampittia dioscorides crop",8:"Ampittia subvittatus (Moore, 1878) – Tiger Hopper",9:"Ancistroides nigrita – Chocolate Demon",10:"Anthene emolus (Godart, [1824]) – Common Ciliate Blue",11:"Anthene lycaenina crop",12:"Apharitis lilacinus (Moore, 1884) – Lilac Silverline",13:"Appias indra (Moore, [1858]) – Plain Puffin",14:"Appias libythea – Western Striped Albatross",15:"Appias lyncida (Cramer, [1777]) – Chocolate Albatross",16:"Appias olferna Swinhoe, 1890 – Eastern Striped Albatross",17:"Argynnis childreni Gray, 1831 – Large Silverstripe",18:"Argynnis hyperbius – Tropical Fritillary",19:"Arhopala amantes",20:"Arhopala atrax (Hewitson, 1862) – Indian Oakblue",21:"Arhopala centaurus (Fabricius, 1775) – Centaur Oakblue",22:"Arhopala perimuta crop",23:"Ariadne ariadne (Linnaeus, 1763) – Angled Castor",24:"Ariadne merione (Cramer, [1777]) – Common Castor",25:"Arnetta vindhiana – Vindhyan Bob",26:"Athyma opalina",27:"Athyma perius crop",28:"Athyma ranga Moore, [1858] – Blackvein Sergeant",29:"Athyma selenophora – Staff Sergeant",30:"Auzakia danava (Moore, [1858]) – Commodore",31:"Azanus jesous (Guérin-Méneville, 1849) – African Babul Blue",32:"Azanus ubaldus (Stoll, [1782]) – Bright Babul Blue",33:"Badamia exclamationis – Brown Awl",34:"Baoris farri – Complete Paint-brush Swift",35:"Baracus hampsoni Elwes _ Edwards, 1897 – Spotted Hedge Hopper",36:"Bhutanitis lidderdalii Atkinson, 1873 – Bhutan Glory",37:"Bindahara moorei Fruhstorfer crop",38:"Borbo bevani (Moore, 1878) – Lesser Rice Swift",39:"Borbo cinnara – Rice Swift",40:"Burara jaina (Moore, [1866]) – Common Orange Awlet",41:"Byasa polyeuctes – Common Windmill",42:"Byblia ilithyia (Drury, [1773]) – Joker",43:"Caleta decidia crop",44:"Caltoris canaraica",45:"Caltoris kumara (Moore, 1878) – Blank Swift",46:"Caprona ransonnettii  crop",47:"Castalius rosimon (Fabricius, 1775) – Common Pierrot",48:"Catapaecilma major Druce crop",49:"Catochrysops strabo (Fabricius, 1793) – Forget-me-not",50:"Catopsilia pomona (Fabricius, 1775) – Lemon Emigrant",51:"Catopsilia pyranthe – Mottled Emigrant",52:"Celaenorrhinus leucocera crop",53:"Celaenorrhinus putra",54:"Cephrenes acalle",55:"Cepora nadina (Lucas, 1852) – Lesser Gull",56:"Cepora nerissa (Fabricius, 1775) – Common Gull",57:"Cethosia biblis (Drury, [1773]) – Red Lacewing",58:"Cethosia mahratta – Sahyadri Lacewing",59:"Charaxes agrarius Swinhoe, [1887] – Anomalous Nawab",60:"Charaxes bernardus hierax – Variable Tawny Rajah",61:"Charaxes bharata – Indian Nawab",62:"Charaxes eudamippus Doubleday, 1843 – Great Nawab",63:"Charaxes marmax",64:"Charaxes psaphon Westwood, 1847 – Plain Tawny Rajah",65:"Charaxes solon (Fabricius, 1793) – Black Rajah",66:"Cheritra freja (Fabricius, 1793) – Common Imperial",67:"Chersonesia risa (Doubleday, [1848]) – Common Maplet",68:"Chilades lajus lajus – Indian Lime Blue",69:"Chilades pandava (Horsfield, [1829]) – Plains Cupid",70:"Chilades parrhasius – Small Cupid",71:"Cirrochroa aoris – Large Yeoman",72:"Cirrochroa thais – Tamil Yeoman",73:"Coladenia indrani (Moore, [1866]) – Tricolour Pied Flat",74:"Colias fieldii",75:"Colotis amata (Fabricius, 1775) – Small Salmon Arab",76:"Colotis aurora (Cramer, [1780]) – Plain Orange-tip",77:"Colotis etrida (Boisduval, 1836) – Little Orange-tip",78:"Colotis fausta (Olivier, 1804) – Large Salmon Arab",79:"Colotis vestalis",80:"Ctenoptilum vasava",81:"Cupha erymanthis – Rustic",82:"Curetis acuta",83:"Curetis bulis",84:"Curetis thetis (Drury, [1773]) – Indian Sunbeam",85:"Cyrestis thyodamas Doyère, [1840] – Map Butterfly",86:"Danaus chrysippus (Linnaeus, 1758) – Plain Tiger",87:"Danaus genutia (Cramer, [1779]) – Striped Tiger",88:"Danaus melanippus (Cramer, [1777]) – White Tiger",89:"Delias belladonna – Hill Jezebel",90:"Delias descombesi",91:"Delias eucharis (Drury, 1773) – Indian Jezebel",92:"Delias hyparete – Painted Jezebel",93:"Delias pasithoe – Red-base Jezebel",94:"Deudorix epijarbas – Cornelian",95:"Dichorragia nesimachus – Constable",96:"Discolampa ethion crop",97:"Discophora sondaica Boisduval, 1836 – Common Duffer",98:"Dodona adonira – Striped Punch",99:"Dodona dipoea",100:"Dodona durga",101:"Dodona eugenes – Tailed Punch",102:"Doleschallia bisaltide – Autumn Leaf",103:"Dophla evelina (Stoll, [1790]) – Redspot Duke",104:"Elymnias hypermnestra",105:"Elymnias malelas",106:"Erionota torus Evans, 1941 – Rounded Palm-redeye",107:"Ethope himachala – Dusky Diadem",108:"Euchrysops cnejus crop",109:"Euploea core core – Indian Common Crow",110:"Euploea klugii Moore, [1858] – King Crow",111:"Euploea mulciber (Cramer, [1777]) – Striped Blue Crow",112:"Euploea sylvester",113:"Eurema andersonii",114:"Eurema blanda (Boisduval, 1836) – Three-spot Grass Yellow",115:"Eurema brigitta – Small Grass Yellow",116:"Eurema hecabe (Linnaeus, 1758) – Common Grass Yellow",117:"Eurema laeta crop",118:"Euripus nyctelius (Doubleday, 1845) – Courtesan",119:"Euthalia aconthea crop",120:"Euthalia franciae",121:"Euthalia lubentina crop",122:"Euthalia phemius crop",123:"Everes lacturnus",124:"Freyeria putli – Black-spotted Grass Jewel",125:"Freyeria trochylus",126:"Gandaca harina (Horsfield, [1829]) – Tree Yellow",127:"Gangara thyrsis crop",128:"Gerosis phisara crop",129:"Gomalia elma",130:"Graphium agamemnon (Linnaeus, 1758) – Tailed Jay",131:"Graphium agetes agetes – Assam Four-bar Swordtail",132:"Graphium antiphates (Cramer, [1775]) – Five-bar Swordtail",133:"Graphium chironides (Honrath, 1884) – Veined Jay",134:"Graphium doson crop",135:"Graphium macareus (Godart, 1819) – Lesser Zebra",136:"Graphium nomius crop",137:"Graphium sarpedon sarpedon – Oriental Common Bluebottle",138:"Halpe porus – Bispot Banded Ace",139:"Halpe zema",140:"Hasora badra crop",141:"Hasora chromus (Cramer, [1780]) – Common Banded Awl",142:"Hebomoia glaucippe – Great Orange-tip",143:"Heliophorus brahma (Moore, [1858]) – Golden Sapphire",144:"Heliophorus epicles (Godart, [1824]) – Purple Sapphire",145:"Heliophorus indicus (Fruhstorfer, 1908) – Dark Sapphire",146:"Heliophorus moorei (Hewitson, 1865) – Azure Sapphire",147:"Heliophorus sena (Kollar, [1844]) – Sorrel Sapphire",148:"Herona marathus Doubleday crop",149:"Hestinalis nama (Doubleday, 1844) – Circe",150:"Horaga onyx",151:"Hyarotis adrastus crop",152:"Hypolimnas bolina (Linnaeus, 1758) – Great Eggfly",153:"Hypolimnas misippus – Danaid Eggfly",154:"Hypolycaena erylus crop",155:"Hypolycaena othona Hewitson, [1865] – Orchid Tit",156:"Iambrix salsala (Moore, [1866]) – Chestnut Bob",157:"Idea malabarica (Moore, 1877) – Malabar Tree-Nymph",158:"Iraota timoleon crop",159:"Ixias marianne (Cramer, [1779]) – White Orange-tip",160:"Ixias pyrene (Linnaeus, 1764) – Yellow Orange-tip",161:"Jamides alecto",162:"Jamides bochus (Stoll, [1782]) – Dark Cerulean",163:"Jamides celeno (Cramer, [1775]) – Common Cerulean",164:"Junonia almana almana",165:"Junonia atlites atlites – Oriental Grey Pansy",166:"Junonia hierta (Fabricius, 1798) – Yellow Pansy",167:"Junonia iphita crop",168:"Junonia lemonias (Linnaeus, 1758) – Lemon Pansy",169:"Junonia orithya crop",170:"Kallima horsfieldii – Sahyadri Blue Oakleaf",171:"Kallima inachus (Doyère, [1840]) – Orange Oakleaf",172:"Kaniska canace crop",173:"Lampides boeticus crop",174:"Lamproptera curius crop",175:"Lasiommata schakra",176:"Lasippa viraja (Moore, 1872) – Yellowjack Sailer",177:"Lebadea martha – Knight",178:"Leptosia nina – Psyche",179:"Leptotes plinius plinius – Asian Zebra Blue",180:"Lestranicus transpectus",181:"Lethe chandica",182:"Lethe confusa",183:"Lethe drypetis crop",184:"Lethe europa (Fabricius, 1775) – Bamboo Treebrown",185:"Lethe mekara",186:"Lethe rohria crop",187:"Lethe sidonis",188:"Lethe verma",189:"Lexias dirtea – Dark Archduke",190:"Libythea lepita Moore, [1858] – Common Beak",191:"Libythea myrrha Godart, 1819 – Club Beak",192:"Loxura atymnus crop",193:"Lycaena panava",194:"Lycaena phlaeas (Linnaeus, 1761) – Common Copper",195:"Matapa aria crop",196:"Meandrusa payeni (Boisduval, 1836) – Yellow Gorgon",197:"Megisba malaya (Horsfield, [1828]) – Malayan",198:"Melanitis leda leda – Oriental Common Evening Brown",199:"Melanitis phedima (Cramer, [1780]) – Dark Evening Brown",200:"Moduza procris (Cramer, [1777]) – Commander",201:"Mycalesis junonia – Glad-eye Bushbrown",202:"Mycalesis mineus (Linnaeus, 1758) – Dark-branded Bushbrown",203:"Mycalesis visala – Long-branded Bushbrown",204:"Nacaduba kurava – Transparent Six-Lineblue",205:"Neopithecops zalmora crop",206:"Neptis hylas (Linnaeus, 1758) – Common Sailer",207:"Neptis jumbah Moore, [1858] – Chestnut-streaked Sailer",208:"Neptis sappho",209:"Notocrypta curvifascia (C. _ R. Felder, 1862) – Restricted Demon",210:"Notocrypta feisthamelii (Boisduval, 1832) – Spotted Demon",211:"Notocrypta paralysos (Wood-Mason _ de Nicéville, 1881) – Common Banded Demon",212:"Odontoptilum angulata angulata – Oriental Chestnut Angle",213:"Oriens goloides (Moore, [1881]) – Smaller Dartlet",214:"Orsotriaena medus (Fabricius, 1775) – Medus Brown",215:"Pachliopta aristolochiae (Fabricius, 1775) – Common Rose",216:"Pachliopta hector (Linnaeus, 1758) – Crimson Rose",217:"Pantoporia hordonia crop",218:"Papilio agestor Gray crop",219:"Papilio alcmenor C. _ R. Felder, [1864] – Red-breasted Mormon",220:"Papilio buddha – Malabar Banded Peacock",221:"Papilio castor castor – Patkai Common Raven",222:"Papilio clytia Linnaeus crop",223:"Papilio crino Fabricius, 1793 – Common Banded Peacock",224:"Papilio demoleus Linnaeus crop",225:"Papilio dravidarum Wood-Mason, 1880 – Malabar Raven",226:"Papilio epycides Hewitson, 1862 – Lesser Mime",227:"Papilio helenus Linnaeus crop",228:"Papilio memnon agenor – Continental Great Mormon",229:"Papilio nephelus Boisduval, 1836 – Yellow Helen",230:"Papilio paris Linnaeus, 1758 – Paris Peacock",231:"Papilio polymnestor polymnestor – Indian Blue Mormon",232:"Papilio polytes Linnaeus crop",233:"Papilio protenor Cramer, [1775] – Spangle",234:"Parantica aglea (Stoll, [1782]) – Glassy Tiger",235:"Parantica melaneus",236:"Parantica sita crop",237:"Parasarpa zayla",238:"Pareronia ceylanica crop",239:"Pareronia hippia – Indian Wanderer",240:"Parnara spp",241:"Parthenos sylvia (Cramer, [1775]) – Clipper",242:"Pelopidas agna",243:"Pelopidas conjuncta (Herrich-Schäffer, 1869) – Conjoined Swift",244:"Pelopidas mathias – Small Branded Swift",245:"Petrelaea dana",246:"Phaedyma columella (Cramer, [1780]) – Short-banded Sailer",247:"Phalanta alcippe (Stoll, [1782]) – Small Leopard",248:"Phalanta phalantha crop",249:"Pieris brassicae",250:"Pieris canidia – Asian Cabbage White",251:"Pithauria stramineipennis",252:"Polytremis eltola – Yellow-spot Swift",253:"Polytremis lubricans",254:"Pontia daplidice (Linnaeus, 1758) – Bath White",255:"Poritia hewitsoni",256:"Potanthus spp",257:"Prioneris sita – Painted Sawtooth",258:"Prioneris thestylis (Doubleday, 1842) – Spotted Sawtooth",259:"Prosotas dubiosa crop",260:"Prosotas nora (C. Felder, 1860) – Common Lineblue",261:"Prosotas noreia",262:"Prothoe franck",263:"Pseudergolis wedah (Kollar, [1844]) – Tabby",264:"Pseudocoladenia dan (Fabricius, 1787) – Fulvous Pied Flat",265:"Pseudozizeeria maha crop",266:"Psolos fuligo (Mabille, 1876) – Dusky Partwing",267:"Rapala iarbus (Fabricius, 1787) – Common Red Flash",268:"Rapala manea crop",269:"Rapala nissa",270:"Rapala pheretima (Hewitson, [1863]) – Copper Flash",271:"Rathinda amor – Monkey Puzzle",272:"Remelana jangala – Chocolate Royal",273:"Rohana parisatis (Westwood, [1851]) – Black Prince",274:"Sarangesa dasahara crop",275:"Sephisa dichroa",276:"Seseria sambara (Moore, [1866]) – Notched Seseria",277:"Spalgis epius (Westwood, [1851]) – Apefly",278:"Spialia galba crop",279:"Spindasis ictis – Common Shot Silverline",280:"Spindasis lohita crop",281:"Spindasis schistacea – Plumbeous Silverline",282:"Spindasis syama (Horsfield, [1829]) – Club Silverline",283:"Spindasis vulcanus crop",284:"Stibochiona nicea",285:"Suastus gremius gremius – Indian Palm Bob",286:"Surendra quercetorum",287:"Symbrenthia hypselis – Spotted Jester",288:"Symbrenthia lilaea – Northern Common Jester",289:"Symbrenthia niphanda – Bluetail Jester",290:"Symbrenthia silana – Scarce Jester",291:"Symphaedra nais (Forster, 1771) – Baronet",292:"Tagiades gana crop",293:"Tagiades japetus",294:"Tagiades menaka (Moore, [1866]) – Spotted Snow Flat",295:"Tajuria cippus cippus – Indian Peacock Royal",296:"Tajuria jehana Moore, [1884] – Plains Blue Royal",297:"Talicada nyseus (Guérin-Méneville, 1843) – Red Pierrot",298:"Tanaecia julii – Common Earl",299:"Tanaecia lepidea lepidea – Himalayan Grey Count",300:"Tapena thwaitesi Moore crop",301:"Taractrocera ceramas",302:"Taractrocera maevius (Fabricius, 1793) – Grey-veined Grass Dart",303:"Taraka hamada mendesia – Mendacious Forest Pierrot",304:"Tarucus balkanica (Freyer, 1844) – Little Tiger",305:"Tarucus indica Evans, 1932 – Transparent Pierrot",306:"Tarucus nara",307:"Telicota bambusae – Dark Palm-Dart",308:"Telicota colon crop",309:"Telinga oculus crop",310:"Thaumantis diores diores – Assam Jungleglory",311:"Tirumala limniace (Cramer, [1775]) – Blue Tiger",312:"Tirumala septentrionis (Butler, 1874) – Dark Blue Tiger",313:"Troides helena",314:"Troides minos crop",315:"Udaspes folus crop",316:"Vagrans egista",317:"Vanessa cardui (Linnaeus, 1758) – Painted Lady",318:"Vanessa indica (Herbst, 1794) – Indian Red Admiral",319:"Vindula erota crop",320:"Virachola isocrates crop",321:"Ypthima baldus (Fabricius, 1775) – Common Five-ring",322:"Ypthima ceylonica",323:"Ypthima huebneri Kirby, 1871 – Common Four-ring",324:"Ypthima newara",325:"Ypthima sakra",326:"Zeltus amasa amasa – Indian Fluffy Tit",327:"Zemeros flegyas flegyas – Himalayan Punchinello",328:"Zesius chrysomallus – Redspot",329:"Zizeeria karsandra crop",330:"Zizina otis – Lesser Grass Blue",331:"Zizula hylax hylax – Indian Tiny Grass Blue"}

def processed_img(img_path):
    img=load_img(img_path,target_size=(224,224,3))
    img=img_to_array(img)
    img=img/255
    img=np.expand_dims(img,[0])
    answer=model.predict(img)
    max_value = np.max(answer)
    if max_value>=0.90 :
        y_class = answer.argmax(axis=-1)
        print(y_class)
        y = " ".join(str(x) for x in y_class)
        y = int(y)
        res = lab[y]
        print(max_value)
        return res
    else :
        print(max_value)
        return -1
        

def run():
    img1 = Image.open('C:/Users/Divyansh/Desktop/Bird_Species_Classification_Streamlit/splash1.jpeg')
    img1 = img1.resize((350,350))
    st.image(img1,use_column_width=False)
    st.title("Butterfly Species Classification")

    img_file = st.file_uploader("Choose an Image of Butterfly", type=["jpg", "png"])
    if img_file is not None:
        st.image(img_file,use_column_width=False)
        save_image_path = './upload_images/'+img_file.name
        with open(save_image_path, "wb") as f:
            f.write(img_file.getbuffer())

        if st.button("Predict"):
            result = processed_img(save_image_path)
            if(result==-1):
                st.error("Image not found in dataset")
            else :

                st.success("Predicted Bird is: "+result)

run()

# streamlit run ButterflyClassification.py
